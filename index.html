<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Registro</title>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("dataForm");
            const statusMessage = document.getElementById("statusMessage");

            form.addEventListener("submit", (event) => {
                event.preventDefault();
                const formData = new FormData(form);
                const data = {};
                formData.forEach((value, key) => {
                    data[key] = value;
                });
                saveDataLocally(data);
                syncDataWithServer();
            });

            function saveDataLocally(data) {
                let localData = JSON.parse(localStorage.getItem("formData")) || [];
                localData.push(data);
                localStorage.setItem("formData", JSON.stringify(localData));
                statusMessage.innerText = "Datos guardados localmente.";
            }

            async function syncDataWithServer() {
                let localData = JSON.parse(localStorage.getItem("formData")) || [];
                if (localData.length > 0) {
                    try {
                        const response = await fetch("/save", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ records: localData })
                        });
                        if (response.ok) {
                            localStorage.removeItem("formData");
                            statusMessage.innerText = "Todos los datos han sido sincronizados.";
                        } else {
                            statusMessage.innerText = "Error al sincronizar los datos.";
                        }
                    } catch (error) {
                        statusMessage.innerText = "Sin conexi√≥n. Datos guardados localmente.";
                    }
                }
            }

            setInterval(syncDataWithServer, 5000); // Intentar sincronizar cada 5 segundos
        });
    </script>
</head>
<body>
    <h1>Formulario de Registro</h1>
    <form id="dataForm">
        <label for="name">Nombre:</label>
        <input type="text" id="name" name="name" required>
        <br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br>
        <button type="submit">Guardar</button>
    </form>
    <p id="statusMessage"></p>
</body>
</html>
